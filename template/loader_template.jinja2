import { ExecutionContext } from "@nestjs/common";
import Dataloader from "dataloader";
import gql from "graphql-tag";
import { manyToManyV3 } from "../base.loader";

export const {{ input_type_name }}Loader = (ctx: ExecutionContext) => {
  return new Dataloader(async (keys: number[]) => {
    const gqlQuery = gql`
      ${ctx["body"]["query"]}
    `;
    return await manyToManyV3(
      keys,
      gqlQuery,
      "{{ input_type_name_singular }}",
      "{{ entity_name }}",
      "{{ key_column }}"
    );
  });
};
